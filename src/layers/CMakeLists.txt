include(cc_library)
include(cc_test)

cc_library(
  NAME 
    layers
  HDRS 
    model_parallel.h
    norm.h
    linear.h
    linear_impl.h
    embedding.h
    pos_embedding.h
    attention.h
    quantization/qlinear_impl.h
    quantization/qlinear_gptq_impl.h
    quantization/qlinear_awq_impl.h
  SRCS 
    linear.cpp
    linear_impl.cpp
    model_parallel.cpp
    pos_embedding.cpp
    attention.cpp
    quantization/qlinear_impl.cpp
    quantization/qlinear_gptq_impl.cpp
    quantization/qlinear_awq_impl.cpp
  DEPS
    :state_dict
    :memory
    :flash-attn.kernels
    :gptq.kernels
    :awq.kernels
    :exllama.kernels
    glog::glog
    gflags::gflags
    torch
)

cc_test(
  NAME
    layers_test
  SRCS
    layers_test.cpp
    pos_embedding_test.cpp
    quantization/qlinear_impl_test.cpp
  DEPS
    :layers
    :state_dict
    GTest::gtest_main
  DATA 
    data/gptq_small.safetensors
    data/gptq.safetensors
)
