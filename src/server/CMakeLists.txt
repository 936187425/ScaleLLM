include(cc_binary)
include(cc_library)

cc_library(
  NAME 
    completion_handler
  HDRS 
    completion_handler.h
  SRCS 
    completion_handler.cpp
  DEPS
    :common
    :tokenizer
    :scheduler
    :request
    :model_loader
    absl::time
    glog::glog
    grpc_proto::completion
)

cc_library(
  NAME 
    grpc_server
  HDRS 
    call_data.h
    grpc_server.h
  SRCS 
    grpc_server.cpp
  DEPS
    :completion_handler
    :request
    absl::strings
    glog::glog
    grpc_proto::completion
)

cc_library(
  NAME
    http_server
  HDRS
    http_server.h
  SRCS
    http_server.cpp
  DEPS
    absl::strings
    glog::glog
    civetweb::civetweb-cpp
)

cc_binary(
  NAME 
    simple
  SRCS 
    simple.cpp
  DEPS
    :engine
    :model_downloader
    torch
    absl::strings
    gflags::gflags
    glog::glog
)

cc_binary(
  NAME 
    scalellm
  SRCS 
    main.cpp
  DEPS
    :completion_handler
    :grpc_server
    :http_server
    :engine
    :model_downloader
    absl::strings
    gflags::gflags
    glog::glog
    Folly::folly
    nlohmann_json::nlohmann_json
)

cc_binary(
  NAME 
    grpc_client
  HDRS 
  SRCS 
    grpc_client.cpp
  DEPS
    glog::glog
    gflags::gflags
    grpc_proto::completion
)
