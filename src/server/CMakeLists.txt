include(cc_binary)
include(cc_library)

cc_library(
  NAME 
    hf_model_downloader
  HDRS 
    hf_model_downloader.h
  SRCS 
    hf_model_downloader.cpp
  DEPS
    torch
    Python::Python
)

cc_library(
  NAME 
    completion_handler
  HDRS 
    completion_handler.h
  SRCS 
    completion_handler.cpp
  DEPS
    :common
    :tokenizer
    :scheduler
    absl::time
    glog::glog
    grpc_proto::completion
)

cc_library(
  NAME 
    grpc_server
  HDRS 
    call_data.h
    grpc_server.h
  SRCS 
    grpc_server.cpp
  DEPS
    :completion_handler
    absl::strings
    glog::glog
    grpc_proto::completion
)

cc_binary(
  NAME 
    simple
  SRCS 
    simple.cpp
  DEPS
    :engine
    :hf_model_downloader
    torch
    absl::strings
    gflags::gflags
    glog::glog
)

cc_binary(
  NAME 
    scalellm
  SRCS 
    main.cpp
  DEPS
    :completion_handler
    :grpc_server
    :engine
    absl::strings
    gflags::gflags
    glog::glog
    Folly::folly
)

cc_binary(
  NAME 
    grpc_client
  HDRS 
  SRCS 
    grpc_client.cpp
  DEPS
    glog::glog
    gflags::gflags
    grpc_proto::completion
)
